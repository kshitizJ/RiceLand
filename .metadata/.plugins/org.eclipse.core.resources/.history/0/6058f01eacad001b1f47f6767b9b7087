<%@page import="java.util.List"%>
<%@page import="com.dao.OrderDao"%>
<%@page import="com.db.DbConnect"%>
<%@page import="com.dao.ProductDao"%>
<%@page import="com.detail.Product"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%
	response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
User user1 = (User) session.getAttribute("user");
if (user1 == null) {
	response.sendRedirect("login.jsp");
}
%>
<!DOCTYPE html>
<html>
<head>
<%@include file="./all_components/common.jsp"%>
<title>My Orders</title>
</head>
<body>
	<%@include file="./all_components/navbar.jsp"%>
	<section id="cartItems">
		<div class="container">
			<div class="row d-flex justify-content-center align-items-center">
				<div class="col-12">
					<h2 class="title">Cart</h2>
				</div>
				<%
					OrderDao orderdao = new OrderDao(DbConnect.getCon());
				List<Order> orders = cartdao.getUserCart(user.getId());
				%>
				<div class="col-12">
					<table class="table">
						<thead class="thead-dark">
							<tr>
								<th scope="col">Product</th>
								<th scope="col">Quantity</th>
								<th scope="col">Subtotal</th>
							</tr>
						</thead>
						<tbody>
							<%
								Product product;
							ProductDao productdao = new ProductDao(DbConnect.getCon());
							for (Cart cart : carts) {
								product = new Product();
								product = productdao.getProduct(cart.getPid());
							%>
							<tr>
								<td>
									<div class="cart-info">
										<img style="border-radius: 5px;"
											src="./assets/images/rice/<%=product.getPath()%>">
										<div>

											<p><%=product.getName()%></p>

											<small>Price: <i class="fas fa-rupee-sign"></i> <%=product.getPrice()%>/Kg
											</small> <br> <a
												href="DeleteCartItem?uid=<%=user.getId()%>&pid=<%=product.getPid()%>"><b>Remove</b></a>
										</div>
									</div>
								</td>
								<td><a
									href="AddSubCartItem?msg=add&uid=<%=user.getId()%>&pid=<%=product.getPid()%>&prc=<%=product.getPrice()%>">
										<i class="fas fa-chevron-up"></i>
								</a>
									<p class="item-amount"><%=cart.getQuantity()%></p> <a
									href="AddSubCartItem?msg=sub&uid=<%=user.getId()%>&pid=<%=product.getPid()%>&prc=<%=product.getPrice()%>">
										<i class="fas fa-chevron-down"></i>
								</a></td>
								<%
									int quantity = cart.getQuantity() * product.getPrice();
								%>
								<td><i class="fas fa-rupee-sign"></i> <%=quantity%>/-</td>
							</tr>
							<%
								}
							%>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</section>
</body>
</html>